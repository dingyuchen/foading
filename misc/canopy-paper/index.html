<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/foader/styles.24acb70e5693e6383b9a.css" id="gatsby-global-css">.popover{position:relative;max-width:16rem;box-shadow:0 10px 15px -3px var(--shadow),0 4px 6px -2px rgba(0,0,0,.05);padding:1rem;border:1px solid var(--separator);border-radius:.5rem;background-color:var(--references-bg);max-height:16rem;overflow:hidden}.popover.no-max-width{max-width:90vw}.popover.with-markdown{font-size:.875rem}.popover h1{margin:0;padding:0;font-size:1rem}.popover ul{padding-left:1rem}.popover .more-content-blind{height:4rem;position:absolute;background:transparent;background:linear-gradient(0,var(--references-bg),var(--references-bg-80) 50%,var(--references-bg-0));top:12rem;width:100%;left:0}.tippy-box[data-animation=shift-away][data-state=hidden]{opacity:0}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=top]{transform:translateY(10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=bottom]{transform:translateY(-10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=left]{transform:translateX(10px)}.tippy-box[data-animation=shift-away][data-state=hidden][data-placement^=right]{transform:translateX(-10px)}.reference{text-decoration:none}.reference:hover{color:var(--references-highlight)}.reference>div{padding-top:.5rem;padding-bottom:.5rem}.reference>div>p{margin:0;font-size:.875rem}.reference>div>ul{margin:0}.references-block{color:var(--references-text);padding:1rem;margin:1rem 0;border-radius:.5rem;background-color:var(--references-bg);transition:background-color .3s ease,color .3s ease}.references-block>div{margin-bottom:1rem}.references-block>hr{margin-left:auto;margin-right:auto;width:8rem}.references-block a{color:var(--references-text);transition:color .3s ease}.references-block>p:last-child{margin-bottom:0}.note-container{background:var(--note-bg);transition:background .3s ease}.note-container:first-child{border-left:none}.note-container .note-content,.note-container .obstructed-label{transition:opacity 75ms linear}.note-container .obstructed-label{display:block;color:var(--text);text-decoration:none;font-size:17px;line-height:40px;font-weight:500;-ms-writing-mode:tb-lr;writing-mode:vertical-lr;margin-top:36px;top:0;bottom:0;left:0;position:absolute;background-color:transparent;width:40px;overflow:hidden;opacity:0;transition:color .3s ease;pointer-events:none}.note-container.note-container-highlighted{background:var(--references-bg);transition:background .3s ease}.note-content img{max-width:100%}@media screen and (max-width:800px){.note-container{padding:16px;width:100%;overflow-y:auto}}@media screen and (min-width:801px){.note-container{transition:box-shadow .1s linear,opacity 75ms linear,transform .2s cubic-bezier(.19,1,.22,1);flex-shrink:0;width:625px;max-width:625px;top:0;position:-webkit-sticky;position:sticky;flex-grow:1;border-left:1px solid var(--separator);padding:0}.note-content{overflow-y:auto;height:100%;padding:32px}.note-container-overlay{box-shadow:0 0 15px 3px var(--shadow)}.note-container-obstructed .note-content{opacity:0}.note-container-obstructed .obstructed-label{opacity:1;pointer-events:all}}.dark-mode-toggle{cursor:pointer;transform:scale(.6)}.dark-mode-toggle input{display:none}.dark-mode-toggle input+div{border-radius:50%;width:36px;height:36px;position:relative;box-shadow:inset 16px -16px 0 0 #fff;transform:scale(1) rotate(-2deg);transition:box-shadow .5s ease 0s,transform .4s ease .1s}.dark-mode-toggle input+div:before{content:"";width:inherit;height:inherit;border-radius:inherit;position:absolute;left:0;top:0;transition:background .3s ease}.dark-mode-toggle input+div:after{content:"";width:8px;height:8px;border-radius:50%;margin:-4px 0 0 -4px;position:absolute;top:50%;left:50%;box-shadow:0 -23px 0 var(--link),0 23px 0 var(--link),23px 0 0 var(--link),-23px 0 0 var(--link),15px 15px 0 var(--link),-15px 15px 0 var(--link),15px -15px 0 var(--link),-15px -15px 0 var(--link);transform:scale(0);transition:all .3s ease}.dark-mode-toggle input:checked+div{box-shadow:inset 32px -32px 0 0 #fff;transform:scale(.5) rotate(0deg);transition:transform .3s ease .1s,box-shadow .2s ease 0s}.dark-mode-toggle input:checked+:before{background:var(--link);transition:background .3s ease .1s}.dark-mode-toggle input:checked+:after{transform:scale(1.5);transition:transform .5s ease .15s}.graph-button{border:0;background:none;cursor:pointer}.graph-button svg g{stroke:var(--link)}.searchWrapper{position:relative;display:block}.inputWrapper{position:relative;color:var(--text)}.inputWrapper .searchIcon{position:absolute;fill:var(--link);left:2px;height:34px;padding:2px 2px 0;pointer-events:none}.inputWrapper input{color:var(--text);font-size:1rem;border:none;height:36px;padding-left:28px;background-color:var(--note-bg);transition:all .3s ease-in-out;width:28px}.inputWrapper input:focus{outline:none;width:100%}.results{-webkit-padding-start:0;padding-inline-start:0;position:absolute;display:block;top:100%;right:0;width:500px;max-height:50vh;background:var(--note-bg);box-shadow:-5px -5px 15px -3px var(--shadow),0 4px 6px -2px rgba(0,0,0,.05);overflow-y:auto;border-radius:8px}.results li{display:block;text-decoration:none;cursor:pointer;padding:16px 24px;border-bottom:1px solid var(--separator)}.results li:hover{background:var(--references-bg)}.results li .title{color:var(--text)}.results li .excerpt{color:var(--references-text)}@media screen and (max-width:600px){.results{right:-85px;width:calc(100vw - 40px)}}.lds-dual-ring:after{content:" ";left:calc(50% - 32px);position:relative;display:block;width:64px;height:64px;margin:8px;border-radius:50%;border-color:var(--separator);border-left:6px solid transparent;border-bottom:6px solid var(--separator);border-right:6px solid transparent;border-top:6px solid var(--separator);animation:lds-dual-ring 1.2s ease-in-out infinite}@keyframes lds-dual-ring{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}header{width:100%;min-height:57px;z-index:5;background-color:var(--note-bg);border-bottom:1px solid var(--separator);display:flex;justify-content:space-between;align-items:center;padding:10px 32px;flex-wrap:wrap;transition:background-color .3s ease}header>a{font-weight:700;color:var(--text);text-decoration:none;transition:color .3s ease}header .controls{display:flex}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;line-height:1.5}body.light-mode{--main-bg:#fafafc;--note-bg:#fff;--text:#1a202c;--separator:#e2e8f0;--shadow:rgba(0,0,0,0.1);--link:#3182ce;--references-bg:#ebf4ff;--references-bg-80:rgba(235,244,255,0.8);--references-bg-0:rgba(235,244,255,0);--references-text:#718096;--references-highlight:#4a5568}body.dark-mode{--main-bg:#000;--note-bg:#0a0d11;--text:#fafafc;--separator:#252525;--shadow:hsla(0,0%,100%,0.1);--link:#3da1ff;--references-bg:#17181a;--references-bg-80:rgba(23,24,26,0.8);--references-bg-0:rgba(23,24,26,0);--references-text:#8c9fbb;--references-highlight:#b3cbf0}body{background-color:var(--main-bg);color:var(--text);margin:0;padding:0;height:100vh;transition:background-color .3s ease,color .3s ease}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,p,pre{margin:0}*,:after,:before{box-sizing:border-box}h1,h2,h3{font-weight:700}hr{margin-top:1rem;margin-bottom:1rem;border:solid var(--separator);border-width:1px 0 0;box-sizing:content-box;height:0;overflow:visible}a{color:var(--link);text-decoration:underline;transition:color .3s ease}a:hover{text-decoration:none}h1{font-size:1.875rem;margin-top:1rem}h1,p{margin-bottom:1rem}.layout{height:100vh;display:flex;flex-direction:column}.note-columns-scrolling-container{display:flex;overflow-x:auto;overflow-y:hidden;flex-grow:1}.note-columns-container{display:flex;flex-grow:1;transition:width .1s cubic-bezier(.19,1,.22,1)}@media screen and (max-width:800px){.note-columns-container{width:unset!important}}.overlay{z-index:98;position:fixed;top:0;right:0;bottom:0;left:0;display:flex;align-items:center;justify-content:center;height:100%;width:100%;background-color:var(--shadow);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px)}.modal{z-index:99;position:fixed;border-radius:8px;background-color:var(--main-bg);box-shadow:-5px -5px 15px -3px var(--shadow),0 4px 6px -2px rgba(0,0,0,.05)}.modal-close,.modal-scale{position:absolute;top:0;right:0;padding:5px;border:0;background:none;color:var(--text);cursor:pointer}.modal-close svg,.modal-scale svg{width:20px;height:20px}.modal-close path,.modal-scale path{fill:currentColor}.modal-scale{right:30px}.modal-minimized .modal-close svg,.modal-minimized .modal-scale svg{width:15px;height:15px}.modal-minimized .modal-scale{right:25px}.modal-body{height:100%;width:100%}.modal-body .node,.modal-body .text{cursor:pointer}</style><meta name="generator" content="Gatsby 2.32.13"/><link as="script" rel="preload" href="/foader/component---node-modules-gatsby-theme-garden-src-templates-local-file-js-776a0c8f4079765c6542.js"/><link as="script" rel="preload" href="/foader/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/foader/app-6d93d4b14443c5d06dab.js"/><link as="script" rel="preload" href="/foader/framework-06f646d936b841f99ebd.js"/><link as="script" rel="preload" href="/foader/webpack-runtime-185bcb39f1618332114c.js"/><link as="fetch" rel="preload" href="/foader/page-data/misc/canopy-paper/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/foader/page-data/sq/d/2098632890.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/foader/page-data/sq/d/2221750479.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/foader/page-data/sq/d/2468095761.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/foader/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout"><header><a href="/foader/"><h3>Foam</h3></a><div class="controls"><div class="searchWrapper" role="combobox" aria-expanded="false" aria-haspopup="listbox" aria-labelledby="downshift-32-label"><div class="inputWrapper"><svg class="searchIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M23.111 20.058l-4.977-4.977c.965-1.52 1.523-3.322 1.523-5.251 0-5.42-4.409-9.83-9.829-9.83-5.42 0-9.828 4.41-9.828 9.83s4.408 9.83 9.829 9.83c1.834 0 3.552-.505 5.022-1.383l5.021 5.021c2.144 2.141 5.384-1.096 3.239-3.24zm-20.064-10.228c0-3.739 3.043-6.782 6.782-6.782s6.782 3.042 6.782 6.782-3.043 6.782-6.782 6.782-6.782-3.043-6.782-6.782z"></path></svg><input type="text" aria-autocomplete="list" aria-labelledby="downshift-32-label" autoComplete="off" value="" id="downshift-32-input" placeholder="Search..."/></div></div><button title="Show Graph visualisation" aria-label="Show Graph visualisation" class="graph-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20"><g fill="none" stroke-width="2"><circle cx="11.733" cy="3.181" r="1.902"></circle><circle cx="16.864" cy="10.861" r="1.902"></circle><circle cx="7.47" cy="16.822" r="1.902"></circle><circle cx="3.046" cy="6.275" r="1.902"></circle><circle cx="9.372" cy="10.861" r="1.902"></circle><line x1="11.635" x2="14.655" y1="10.861" y2="10.861"></line><line x1="10" x2="10.895" y1="8.959" y2="5.573"></line><line x1="7.47" x2="4.5" y1="9.68" y2="7.5"></line><line x1="8.25" x2="8.809" y1="14.92" y2="13.088"></line></g></svg></button><label class="dark-mode-toggle" aria-label="Activate dark mode" title="Activate dark mode"><input type="checkbox" checked=""/><div></div></label></div></header><div class="note-columns-scrolling-container"><div class="note-columns-container" style="width:1250px"><div class="note-container   " style="left:0;right:-585px"><div class="note-content"><h1 id="canopy-an-end-to-end-performance-tracing-and-analysis-system">Canopy: An End-to-End Performance Tracing and Analysis System</h1><p>#paper</p><p><a href="https://cs.brown.edu/~jcmace/papers/kaldor2017canopy.pdf">Original paper</a></p><p>Canopy is Facebook&#x27;s end-to-end performance tracing infrastructure.
Canopy records causally related performance data across the end-to-end execution path of requests, including from browsers, mobile applications, and backend services.</p><p>Canopy addresses three challenges we have encountered in scaling performance analysis: supporting the range of execution and performance models used by different components of the Facebook stack; supporting interactive ad-hoc analysis of performance data; and enabling deep customization by users.</p><p>This paper makes the following contributions</p><ol><li>A decoupled design for tracing that separates instrumentation from the trace model, enabling independent evolution and the composition of different execution models.</li><li>A complete pipeline to transform traces into a custom set of extracted features to enable rapid analysis</li><li>A set of customizable tracing components to provide multiple views of the same data for different use cases.</li></ol><h2 id="motivation">Motivation</h2><p>Each system was specialized for a specific use case and difficult to extend to other domains.</p><p>This siloed approach to tracing led to several problems.
It was difficult to get cross-system insights when the tools themselves didn&#x27;t cross all systems, and it meant that engineers needed to understand multiple tracing tools and when to use and switch between them.
The type of analysis supported by each system was also fairly rigid and changes took days to deploy.</p><h3 id="canopy-in-action">Canopy in Action</h3><p>Aggregate trace data allowed engineers to pinpoint load issue that introduced 300ms of latency for page loads.</p><h2 id="challenges">Challenges</h2><h3 id="modeling-trace-data">Modeling Trace data</h3><p>Performance traces incorporate a wide range of information from all components on the execution path of requests, from clients through backend services.
Exposing traces as DAG of events is inappropriate for 2 reasons.</p><ol><li>In order to reconstruct high-level concepts, engineers must understand and interpret trace events and their causal relationships.</li><li>Events are an inappropriate abstraction to expose to engineers adding instrumentation to systems. Engineers must understand how to describe their system&#x27;s execution model in terms of events, and do so in a coherent manner across all system components.</li></ol><p>Directly encodes high level traces as a first-class primitive.</p><p>However, there is a lost in generality. (execution model is not easily described as [<a title="Span Trees" href="/foader/misc/span-trees">span-trees</a>]).</p><p>Changing trace models entailed exhaustively revisiting system-level instrumentation, or elaborate workarounds such as inferring new attributes.</p><h3 id="analyzing-data">Analyzing data</h3><p>Engineers need to be able to view, filter, and aggregate metrics based on arbitrary features across all traces.
However, traces are at an inappropriate level of granularity.</p><ol><li>Traces are very rich, with an individual trace comprising potentially of tens of thousands of performance events. It is computationally infeasible to directly query this volume of traces in real-time in response to some use query.</li><li>It is cognitively demanding to expect users to write queries at the granularity of traces.</li></ol><h3 id="supporting-multiple-use-cases">Supporting Multiple Use Cases</h3><p>Facebook traces have evolved over time as operators find new data they are interested in.</p><h2 id="design">Design</h2><p>Canopy addresses the challenges by providing a pipeline for extracting performance data from system-generated traces across the stack.</p><h3 id="overview">Overview</h3><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:561px">
      <a class="gatsby-resp-image-link" style="display:block" target="_blank" rel="noopener" href="/foader/foader/static/60244cd7468dce7bb86abbc9aafdcae5/40040/2021-05-01-18-12-54.png">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:145.7142857142857%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAYAAACqhkzFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEPklEQVRIx4VVaZfiNhD0//9N+ZS3G5aZ4TS3MZfNgPEBNticM7VdjcWSSbLRe0KyjlJ3dXVjRVGE4WiE2WyO2+32q398PObX69N6Of/8/PxH57oFaTyUn066yMbf2+X0OMhmQHVf1o7HI4qiePTD4YAPMcLioTzb48/pAJs8g2lR6xuuxf7x7fsR/GWkc16cTqdw3THato35YoHNZoPL5QLrfDnDdcawXQfvmwDuyscmDJElIZI4wmoVYLkMMJn5ArBAlt0fJSB7r99HHCcPy63dbodet4s/Kt/wo/qC7806wu0WJ6EgEzemUw+Vv17R77vodhyE8hhbsA7Uwte3NzjjsVBy1XXLuHQSTsjLXILjj7oIHFt6F+PREGmW8nlx9fagYCRg7nSG4XCI1XqNRIwgqGWIJy9suRDs9m1Me224nQaC1UrXyQ8DkyQJzqcjesM+7F4fAwEMgkCoWeu+hTKKhoPn7+d1E21ySHC2w2GPtbgex/GDW4tOHE8X5HkuvJ31cMF5ScFRLOZ4Pp+1k1t2M6dKOL9crneX56sYr4026o0Ger0e+oOhRq7RbKIrLjVkvd3pKFfNVgsdCSDdZK/8qMKdTNBut9Fq29jvD7CWS18vUAI8RCCOBO1LJ0Cn24Pd6Soo9/qDge6xOyI5PtwRjKI4worCjQB2MZ/PMXZd7UxFitX3fYxFEvym5bPZTNcnpQY9z5P5RK2Mk+SXbExK/V+jEj5LNXwNGPWsqfe7iLLt93tsRWPv70vMxAt6wsvMXQbSnD2VtUB1eJH0O8jm+Xx5WMIDjDhzdCVanC/mwt9IOfWXSwWly4zsuYy8AnISSwn7Xqmg3myp+wRiGjpjV+emujQlYMYirm8FlDy/vLxg4fn4IOB/8WUu0jrHcdBqtVGVi12R1kiCtNulD29MHmtQqHDyYkvYeXgtaZQksQJ44prnLTTdeI7jXrjjnBY/823mFlV+EOIZekqC3+RnKokfRrEE413Sa61cLsq69xXwGdj6KEu9aTT/OZsZYVpM3S3FYi2s8jgf4h6BGQeVFC0kR81mQ1KnrW4v5SAvvtVqKmBfIknpmMbKQkspco7jsaMpmSTbu4WMFl9hTQuje4mnDMIwUq1RLq5kz0KAaRUDRM75KPdpHUdi/K3Afo2uaeQrTXcKRiBPZMJyRa5NK8qKpIDPBdbwYP4SeZGRZdknMIXMypymaamG5GGhocX6Xe7y5UwOpmmGQixgENi5TiUw9b42a1d8IkwykcZKXyXp/NfzfE9FTYsysYj8RmJxnh/UYgaB6+Se5zjSbes9iDEYuSLklpYp/s+yFvK7WWYHFcA5C7ApvhypCs451ut17OQBy/fmqFSrsmjrhZfXN9gCqkVTCgHlU5PDTcnzWq2ul/VBeeRePycqL0Y9zwtYqZAdiPqJTl7oFl2niwwKOeMfEUdmiRnp4r+1n+ZIjoL4usCiAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="2021 05 01 18 12 54" title="2021 05 01 18 12 54" src="/foader/static/60244cd7468dce7bb86abbc9aafdcae5/410f3/2021-05-01-18-12-54.png" srcSet="/foader/static/60244cd7468dce7bb86abbc9aafdcae5/0d3e1/2021-05-01-18-12-54.png 140w,/foader/static/60244cd7468dce7bb86abbc9aafdcae5/6b1e2/2021-05-01-18-12-54.png 281w,/foader/static/60244cd7468dce7bb86abbc9aafdcae5/410f3/2021-05-01-18-12-54.png 561w,/foader/static/60244cd7468dce7bb86abbc9aafdcae5/40040/2021-05-01-18-12-54.png 616w" sizes="(max-width: 561px) 100vw, 561px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><ol><li>Facebook engineers instrument system components to record performance information</li><li>Incoming requests to Facebook will traverse the instrumented system components.</li><li>Each request is assigned a unique <code>traceID</code> that is propagated along the end-to-end path.</li><li>Canopy generates events capturing performance information and causality with respect to prior events during execution</li><li><strong>Tailer</strong> aggregates events in memory</li><li>and persists them to storage</li><li>Once all events have been received for a request, they are queued for processing</li><li>Events are mapped to a <strong>trace model</strong></li><li>Canopy evaluates user-supplied <strong>feature lambdas</strong> which extract or compute interesting features from each modeled trace</li><li>Users bundle their feature lambdas with a dataset configuration that specifies predicates for filtering unwanted traces and directions for where to output the extracted features.</li><li>Facebook engineers can query datasets directly and view visualizations and dashboards backed by the datasets.</li><li>Canopy provides several shared datasets and visualization containing common high-level features, plus tools for drilling down into the underlying traces if deeper inspection is needed.</li></ol><h3 id="instrumentation-api">Instrumentation API</h3><p>Instrumentation broadly comprises three tasks</p><ol><li>propagating the <code>TraceID</code> alongside requests as they execute, to associate performance data generated by different components</li><li>recording the request structure<ol><li>where and when it executes</li><li>causality between threads and components</li><li>network communication</li></ol></li><li>capturing useful performance data<ol><li>logging statements</li><li>performance counters</li><li>stack traces</li></ol></li></ol><p>Facebook&#x27;s web servers are heavily continuation based, so Canopy does not expose these concepts because it is difficult to manually track causality through asynchronous calls and accurately attribute performance counters to work done.</p><p>Canopy&#x27;s PHP instrumentation library only supports noting points in time and wrapping function to profile, eg:</p><pre><code>Canopy()-&gt;inform(&#x27;Evicting Cache Entry&#x27;);
Canopy()-&gt;measure(&#x27;Evicting&#x27;, $evictFunction);
</code></pre><p>Internally, Facebook&#x27;s web runtime will propagate the <code>TraceID</code>;
track causality through continuations;
snapshot lightweight performance counters exposed by the server;
and generate events that capture the order of, and relationships between, asynchronous function calls;</p><p>Canopy provides orthogonal performance APIs;
to register user-defined counters;
to enable/disable stack trace sampling;
and to capture OS-level information</p><h4 id="why-decouple">Why decouple</h4><ol><li>Lower barriers to entry</li><li>Robust data, avoids inconsistencies</li><li>Support custom system designs, interoperability with other tracing libraries.</li></ol><h3 id="trace-events">Trace Events</h3><p>Canopy traces have a generic underlying representation based on events.
Together, the events of a trace form a directed, acyclic graph (DAG).</p><h4 id="event-definition">Event definition</h4><pre><code>struct Event {
  1: required string traceID;
  2: required string type;
  3: required id1;
  4: optional id2;
  5: optional i64 sequenceNumber;
  6: required i64 timestamp;
  7: optional map&lt;string, string&gt; annotations;
}
</code></pre><p>Canopy has an implicit and extensible set of event <strong>types</strong> that determine how Canopy&#x27;s backend will interpret the event.</p><p>Canopy uses sequence numbers and timestamps to order events within the same process or thread,
and random IDs to relate events to shared concepts.
For example, we typically generate and log an <code>EventID</code> on the sender, propagate both <code>TraceID</code> and <code>EventID</code> to the receiver, then also log the <code>EventID</code> on the receiver, to capture inter-process causality.</p><h3 id="modeled-traces">Modeled Traces</h3><p>Canopy&#x27;s model describes requests in terms of execution units, blocks, points, and edges.</p><ul><li>Execution units are high level computational tasks approximately equivalent to a thread of execution</li><li>Blocks are segments of computation within an execution unit;</li><li>Points are instantaneous occurrences of events within a block;</li><li>Edges are non-obvious causal relationships between points.</li></ul><h3 id="trace-datasets">Trace Datasets</h3><p>Trace-derived datasets are Canopy&#x27;s high-level output.</p><p>Each row of a dataset corresponds to some element in a trace.</p><h4 id="features">Features</h4><p>Each column of a dataset is a feature derived form a trace.</p><h4 id="extraction">Extraction</h4><p>Canopy transform traces to features by applying feature extraction functions</p><pre><code>f: Trace -&gt; Collection&lt;Row&lt;Feature&gt;&gt;
</code></pre><p>The main requirements for feature extraction are to: </p><ol><li>enable engineers to iterate and deploy changes quickly</li><li>be extensible to support new and unanticipated types of analysis</li><li>encourage modular and composable extraction functions</li></ol><p>Features can be extracted as traces arrive or retroactively, and new feature extraction functions can be quickly deployed to production.</p><h4 id="analysis">Analysis</h4><p>Canopy outputs features to subsequent processing pipelines, including both online in-memory table stores and persistent storage for offline batch analysis.</p><p>Precomputing features:</p><ol><li>The source events and modeled traces remain stored in our storage layer and can be retrieved for either individual viewing for batch ad-hoc analysis.</li><li>Features are causally related, so dataset queries can combine and break down data in a myriad of ways;<ol><li>We can slice data by different dimensions without having to infer or compute causality between distributions.</li><li>In practice most problems are solved by exploring different combinations of a small set of features ,and combining common features such as latency with less common features.</li></ol></li></ol><h2 id="implementation">Implementation</h2><h3 id="canopy-client-library">Canopy Client Library</h3><p>Canopy&#x27;s instrumentation APIs internally map down to a core client API that provides 2 main functions:</p><ol><li>starting a trace</li><li>logging an event</li></ol><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:561px">
      <a class="gatsby-resp-image-link" style="display:block" target="_blank" rel="noopener" href="/foader/foader/static/bf4e7529eaa85786823a84c513b23723/41d3b/2021-05-01-20-20-46.png">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:64.28571428571428%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACfElEQVQ4yzVTiXabQAzk//+qfU3bNGkS2zG2uS+DuQ9jDPiYjtYN7wmx2kE70mi1y+WC0+mE4XzG0LVouwbdqcd5GDDQZE/ty5q+b2ti+seaJri6rpXdbjdoXdchjvcoqhrJZoH1+h3bMEBLQFEUOB6PaJsGZVkiYTxY/MZyZam9PM+VhWEI0zIxjhO083lQgSzLkJcV4jSF7bkIwghBEOBEBlldwfF9JIcDSh683+/hcx1GEVzPQ3eUCs6QR5OSxeS5X6/Y+g7erC08SRDHSHnAInBgJpHCNE0LXbegr3WsdR22bcE0fXjuY1+b5wtrv6vFjda2HTwvwNtyRVYhSiYoyxpV1ShMTyZ5VcFyXZqHtKhU/Mr+3e93aAMF2Ohrlhji4Oxgvj4h/HyB+/4LzttP2H+fYH88w1u94rD9gLN4we75mzLr9Qd2f77DISbz7QfDkepaloUzfZWn8KwdQseCbxuIAw/X8YT5dMREO9UlbGPLuEuBPOTJntQmXIae6j8q0KZpVgpKz5arT2x2Bsq6wXmaUFCkmgonhxQVYyOxGVVN80JhRLCIfbYcl6LmSgttHEeqFsNlT0zThGEayDkSl8usBInjx5745v/4iJfZ7PteKe44jppD1UOhmWWpCgrLiADbtuEwifwkIL7U6TJ72y0ngGMlClvECbb/wknJV/phnEk9UUlkrsSkNEly5SiJn+dZHSAzG3DAXSoc8VsS+pzXmi1QDI2ogR60CJLiwYxMJXEQhMovVyvsDIOzp2NDdga/JS44N4x5CUIyz1V1E/uuFWQiZUq/5BrJbTjwW/oqLKVnspfyJsnNkZ5JXP7L2hF1P6mWfD3/ABZryrbw0u4zAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="2021 05 01 20 20 46" title="2021 05 01 20 20 46" src="/foader/static/bf4e7529eaa85786823a84c513b23723/410f3/2021-05-01-20-20-46.png" srcSet="/foader/static/bf4e7529eaa85786823a84c513b23723/0d3e1/2021-05-01-20-20-46.png 140w,/foader/static/bf4e7529eaa85786823a84c513b23723/6b1e2/2021-05-01-20-20-46.png 281w,/foader/static/bf4e7529eaa85786823a84c513b23723/410f3/2021-05-01-20-20-46.png 561w,/foader/static/bf4e7529eaa85786823a84c513b23723/41d3b/2021-05-01-20-20-46.png 774w" sizes="(max-width: 561px) 100vw, 561px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><h4 id="initiating-traces">Initiating Traces</h4><p>A call to start a trace must first acquire a token from a distributed token bucket.</p><h4 id="sampling-policies">Sampling Policies</h4><p>From the user&#x27;s perspective, rate limiting is an insufficient granularity for sampling traces</p><blockquote><p>What is a tenant in this context?</p></blockquote><blockquote><p>per service?</p></blockquote><ol><li>low Query-per-second (QPS) API calls will be underrepresented </li><li>users cannot target requests with specific properties</li><li>different tenants cannot initiate traces from the same entry point</li><li>it takes a long time to change the rate of generated traces</li></ol><p>Each sampling policy specifies </p><ol><li>an owner</li><li>a sampling strategy (probability or rate)</li><li>restraints that the request must satisfy<ol><li>specific endpoint, data center, region, ...</li></ol></li><li>lifetime for the policy</li><li>level of detail to record</li></ol><p>Canopy also allows teams to mark a codepath as having been reached; they can then define policies that target those particular paths</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:561px">
      <a class="gatsby-resp-image-link" style="display:block" target="_blank" rel="noopener" href="/foader/foader/static/e5cf2a6394a7d6f2c106c0a0ca097fad/41d3b/2021-05-01-20-21-32.png">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:46.42857142857143%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABv0lEQVQoz21S2XKjMBDk/z9qtyq1TnnDGoidGGMwxjaY+77x0ZkRyduqahCSZlrdPZL6vkfXdRiGET3Noe8jDEMEQYAoitA0DcZxpPMBnPsTvOY613NxPB5RlhV4SG3bioSm61HGAQ4bBep6A1mWsd5sYB0OSNNUAD/udzweD9xuN0zThDiOCahElmUCQwDyp65rGIYB7f0dESVxERcwC545zqcTVE2Dru/AJFiBoqrY7XY40dlIOQKQb7dtG57nwbte0XYt3ZzifPaJyQjHuaKqamKRCGkeSUySmBjXcN2LYDl9gz2fT0hJkmC/N1EQ9bzIMa8dLF5XkP9p+PV7AX1n43IJqDgjZil5nIi170ekrhJesqrZQ/JGUxXIb3/xZ7GgeMVKWcOyHAI+EvszTJPnC7ZbA8vlivLXeHlZklSX8kyYloWfIbXDHWl9Q9GMwlxmWVUz23EcyK+GGLQi2I66LoWKLEuR57Mibgx3mZslXaMCsu7CdiPsTYtYGdiS8Yqi4uPjk1jpxOIgmsFMuAnGfg+HGhEL4AxFUSCkJzYxIN9clTka8qKuG9HBsqrEM+Gb+QXwXvW9N//Pe/8bX7rqofQldluDAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="2021 05 01 20 21 32" title="2021 05 01 20 21 32" src="/foader/static/e5cf2a6394a7d6f2c106c0a0ca097fad/410f3/2021-05-01-20-21-32.png" srcSet="/foader/static/e5cf2a6394a7d6f2c106c0a0ca097fad/0d3e1/2021-05-01-20-21-32.png 140w,/foader/static/e5cf2a6394a7d6f2c106c0a0ca097fad/6b1e2/2021-05-01-20-21-32.png 281w,/foader/static/e5cf2a6394a7d6f2c106c0a0ca097fad/410f3/2021-05-01-20-21-32.png 561w,/foader/static/e5cf2a6394a7d6f2c106c0a0ca097fad/41d3b/2021-05-01-20-21-32.png 774w" sizes="(max-width: 561px) 100vw, 561px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><p>For web and mobile requests, before acquiring a token, a call to initiate a trace will first consult the user-defined sampling policies to determine whether any user is interested in the request.
If a policy matches, the call invokes the policy&#x27;s sampling strategy, and only if it passes do we finally acquire a token from the relevant tenant&#x27;s bucket.</p><p>A local <strong>Configerator</strong> daemon manages Canopy&#x27;s sampling and token bucket configurations in-memory and synchronizes global updates in real-time.</p><h4 id="generating-events">Generating Events</h4><p>For sampled traces, calls to Canopy&#x27;s instrumentation APIs will internally log events.</p><p>Events are flushed to <strong>Scribe</strong>, a distributed messaging system for log data.</p><h4 id="opportunistic-tracing">Opportunistic Tracing</h4><p>For a subset of use cases, there are restraints that can only be evaluated part-way through the request, for example
a web request which begins on the client but has server-side restraints</p><p>The client opportunistically persists in memory any events.
After the server makes a sampling decision, it communicates that decision back to the client in the response.
The Canopy client then flushes or discards the pending events.</p><p>In general, opportunistic tracing is only supported when the number of traced components are small, since turning tracing off requires informing all systems that have been propagating the <code>TraceID</code>.</p><h3 id="canopy-pipeline">Canopy Pipeline</h3><p>Canopy&#x27;s <strong>tailer</strong> is a shared backend process that receives, processes, and persists trace data.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:561px">
      <a class="gatsby-resp-image-link" style="display:block" target="_blank" rel="noopener" href="/foader/foader/static/23f18cb64a362c5983d139a24f461060/c8e86/2021-05-01-20-22-28.png">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:81.42857142857143%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXUlEQVQ4y42U/Y6iQBDEff+X2nuA87LJrbsKfqMgyocoigrY17/GIbfJ/XGTjJJhpqq6uobB8/mUx+Nhs65rKS8XSZJE8uNRzufS1tq2laZp5H/GgAPL5VK2YSjb7VaiKBLPm8h8Phff92W1Wkn4epemqSQ6N5uNnbnf71IUhRKf5Xa7SaviBjCz6aiK2FCWpRwOB9sIGMDxfi/n00kiBd7tdkb0cziU6nqV9/d3A0cI4gbIbJpaAmUNo1DW67UCre3/pgStEkJE2Ve143gsrDRnk3u+6DsrGQ+ZbiAfFajES0AZVVXpemRqsGC/P/SA7FssFh0gP64xdd1Inud2YBfHVgbewL7XshMlmXiegZ2UGJIeUIl6QEruGrKTpfpGg4IgECcckizL5KFqO+WpxEqYZblc1UeXkH+WjBpKRtF4PFZFvimlwwDjpfON51TVofCkTesB/x4WDd3gPJtOp6YKMMhQhM+kgsb9eHuT4fCX/P74MBID5AAlEwMOwQwgh1BbFKcekMATI6eKmEHC5NyAl6PRSEafnzLTzBELmGD3tAF4SWdns5nZQDbHk4mCnfvyv90UDvtaludPrXMwooayYD0oCKBMKjEiDXame1wCXENMoUPuTH5KoWWglJIYNGStYEQp0vLDMOpy+moGVuFzEGy6m9J1mTC2NvM8sw1htLPrRzwA4Ap+jb/02nkGFL6uobPBed93uby1UlSqsKxko6x4m74+BIEp3EoQxrKJEgNgHTJscF+ib4D5pZH54S7Xe6vMsQEyo748DXRRSVY23bOuYQeXwF1BsP4ApRfBe+jyp3EAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="2021 05 01 20 22 28" title="2021 05 01 20 22 28" src="/foader/static/23f18cb64a362c5983d139a24f461060/410f3/2021-05-01-20-22-28.png" srcSet="/foader/static/23f18cb64a362c5983d139a24f461060/0d3e1/2021-05-01-20-22-28.png 140w,/foader/static/23f18cb64a362c5983d139a24f461060/6b1e2/2021-05-01-20-22-28.png 281w,/foader/static/23f18cb64a362c5983d139a24f461060/410f3/2021-05-01-20-22-28.png 561w,/foader/static/23f18cb64a362c5983d139a24f461060/c8e86/2021-05-01-20-22-28.png 758w" sizes="(max-width: 561px) 100vw, 561px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><h4 id="routing-events">Routing Events</h4><p>Scribe routes events from instrumented Facebook components to tailers, and shards events by <code>TraceID</code> to ensure all vents for a given trace will route to the same tailer.</p><p>A pool of <strong>fetcher</strong> threads run a loop of polling Scribe.
Fetchers immediately write each event to HBase for persistent storage, then insert into an in-memory cache.</p><h4 id="handling-events">Handling Events</h4><p>For each event, fetchers evaluate a set of <em>triggers</em>, which examine the event for distinguishing markers or features that can categorize the request.</p><p>In the case that more events are received later, the triggers are evaluated again and it is processed twice.</p><h4 id="load-shedding">Load Shedding</h4><p>For each trace-trigger pair, a builder will first retrieve the trace&#x27;s events from cache before processing.
If its events expired from the cache, the trace is enqueued to a separate <strong>delayed extractors</strong>.</p><p>Delayed extractors perform the same actions as the tailer but retrieving their events from HBase.</p><h4 id="model-construction">Model Construction</h4><p>To construct a modeled trace, each event builder inspect its type and delegates to an event handler for that type.</p><p>Builders make further passes over the trace to:</p><ol><li>handle incomplete model elements,</li><li>correct any errors</li><li>infer additional model elements</li><li>align timestamps across distinct hosts using causal edges</li></ol><p>Builders annotate model elements with any changes or corrections so that Canopy engineers can revisit and fix the model or instrumentation</p><p>Finally builders validate a set of invariants on the trace.</p><h4 id="feature-extraction">Feature Extraction</h4><p>Builders evaluate user-defined <strong>dataset configs</strong></p><p>A dataset config comprises</p><ol><li>an owner,</li><li>a filtering predicate</li><li>an extraction expression</li><li>output database information</li></ol><p>Builders apply the filtering predicates to determine valid configs, then enqueue the trace into one or more <strong>isolation queues</strong></p><p>If trace cannot be enqueued it is sent to the delayed extractor.</p><p><strong>Extractor</strong> thread poll the queue for traces.
Extractors evaluate extraction expressions and output to the configured databases.</p><h3 id="scalability">Scalability</h3><h4 id="routing-events-1">Routing events</h4><p>Canopy&#x27;s backend trivially scales by provisioning more machines.</p><h4 id="events-and-datasets">Events and datasets</h4><p>Number of events per trace increase as instrumentation matures</p><p>To address this, we introduce multiple levels of trace details for user to specify in their sampling policy.</p><h4 id="feature-extraction-1">Feature Extraction</h4><p>Canopy provides a DSL for describing features and pipelines of functions.</p><p>Computed features grew more complex than expected, DSL had to incorporate more general purpose features like data structures.
Canopy also currently allows for iPython integration for ad-hoc analysis.</p><h3 id="querying-and-visualization">Querying and Visualization</h3><p>Typically engineers start from an aggregate view of the collected trace data.</p><h2 id="evaluation">Evaluation</h2><p>Canopy </p><ol><li>enables rapid performance analysis across heterogenous systems with different execution and performance models</li><li>Supports many users concurrently and enables customization for different use cases</li><li>enables independent evolution of the trace model, to adapt to new use cases and execution types</li><li>scales to a large number of traces with low overhead</li></ol><h3 id="overheads">Overheads</h3><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:561px">
      <a class="gatsby-resp-image-link" style="display:block" target="_blank" rel="noopener" href="/foader/foader/static/c1288ad32f954a846d65207d9ba9210f/5bb8b/2021-05-02-09-02-26.png">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:34.285714285714285%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABd0lEQVQozz2SCY6jMBBFc/9jTV9gNFkbwm5svAAdoBOSTvKmQJqxZNWqX9+/vEHO+/3+f1+vF8/nc/XHcURVivl+5zIMTNOEtY5B/MXO87zapU9rs0CxMU0jSUscx7Rtx+1243q9cheQ4BuOh9/00uPTBKsKsiyiMYoo2uGkHidHrNMc4h33x8ymKEsW0D/bLdvdnq7r+HcuY0+iI8ahp9XS52tSl9P3ntKkQsCidEoYW04+5fq4sUmznLKqSJIz+8ORPC/wzq1PHIIjJDFfXUCVMVpllHnEUCv69MwkckyJAArjuIqYF4a2MXRt4PPztLLc7/f8+vjgfE7op57YxPhLILMpZasofImfOk7NmfDdk3ohEIR5eeI2X9nkdsS1X1SqQhtDXdcYsYuulTCpZGBtNLU1ZFVBXpVrXruGQnzVaCqp56bm8fMjS7m8GL7vK0Ar+nnvZWIghFaW4lertcbJNo1paKXWiObBB5zzErcS2zV+ye/4C2VAChFpefq8AAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="2021 05 02 09 02 26" title="2021 05 02 09 02 26" src="/foader/static/c1288ad32f954a846d65207d9ba9210f/410f3/2021-05-02-09-02-26.png" srcSet="/foader/static/c1288ad32f954a846d65207d9ba9210f/0d3e1/2021-05-02-09-02-26.png 140w,/foader/static/c1288ad32f954a846d65207d9ba9210f/6b1e2/2021-05-02-09-02-26.png 281w,/foader/static/c1288ad32f954a846d65207d9ba9210f/410f3/2021-05-02-09-02-26.png 561w,/foader/static/c1288ad32f954a846d65207d9ba9210f/5bb8b/2021-05-02-09-02-26.png 749w" sizes="(max-width: 561px) 100vw, 561px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><p>Overheads are higher in clients than on servers because we often lack system-level methods for capturing data and instead rely on application-level methods</p><p>Canopy&#x27;s backend components require less than 0.1% of available data center resources.</p><h3 id="load-shedding-1">Load Shedding</h3><p>We evaluate the tailer&#x27;s ability to isolate tenants, manage load spikes and prevent tenant interference.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:561px">
      <a class="gatsby-resp-image-link" style="display:block" target="_blank" rel="noopener" href="/foader/foader/static/b04ce1d753cb93fdde96093d2165d671/d54e4/2021-05-02-09-54-10.png">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:102.14285714285714%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAADJElEQVQ4y21UCZKiQBDk/z+bDccDkFsBBxVPBPEaj9zKwt7Z2NiOqGgaurMys6qxIOP1euF2u6FpGmy3W9R1jYNEezrhhW48Hg98f3//Ca457vc7trsd9vs9ns8nrMXujPl8gdWqxGJZYrlcaqxWK1kvcT6f0batxvV6/RNMTgACVlWloIfDAdbldsfxeNSXlbxgdrJlGBb/G/x2uVw0CM7gs7Vvu0MnYRDHMXqfn4iiCJ/9PorFAieRnWWZWkHmaZrqPs7r9VoTF0UhMVcV1uHcAZLuQgDm87nOWZ5jvdkocx7YyDNtoAW7tzwCck0LCMbk1lMKslwuEElWAtC32WyGsuz8PMrGvwfBaBHBKfMuFg0GA8RJosDW6nDDXBilaaaV5aDZDFafTMiakllJ+kQ2BOP6dGoxHI0QhFFXFLFXMzLzer1RGR27UmVShjGf+/iNBwnG9mKVmZgz/bTmuwsKaZtcPEvF/FAKMvZ8nes3YzOaplY2yWSiko18JmCHkLVVHa/qGyXtdns1mZuM2ZzJksEDelgKRdlkTXbaJSKdBCwu2mODXArBrKxuIZ6xIMW74pPpVK0w/prRtkckUowkmeg+9rC1ae4qlxKn0ltkWwowmTAjmZnZyONBw9RxXYRhKEUJ1QLrdL2r0fSFG8jA3Gsjk4D/ghrfuJfyWSQF7Mi/UO23mtlc+JN4x8F3lPuQRNW7hTrpD+wExNiwfz9b1fmF+gIcb0DddNm3G7bPqvvryDpNp+Jjqn5FUaxeG4Z1fRBmW+1hbewwK9EPvuBNCvExhu3YCCZfcPwYjjzbtoMg8PU2ENB2HHz8+oAfBPC8MZyIexP0ej2xbgUrz6ZwnRFc11ZzaXKQpEjzLwEK9J09DqT/bE0QpQvEmVzVKNRvQ8dDECXyzdFiWqwwr43n+1plMhi7DhzbhjseS7GmCGZ7uasTZdrrD+XeJ/BlPyvryl4GibDNLMrwfdL3REaoMpJZCccLlSEzE8iT2zOWPfy1DYYDTTySW6ME+E2S5/nMMAwxleaN1fQIWVFikub67NIC+R4LKwKyT00r/bTVzw/2NwbS2a9eDtC9AAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="2021 05 02 09 54 10" title="2021 05 02 09 54 10" src="/foader/static/b04ce1d753cb93fdde96093d2165d671/410f3/2021-05-02-09-54-10.png" srcSet="/foader/static/b04ce1d753cb93fdde96093d2165d671/0d3e1/2021-05-02-09-54-10.png 140w,/foader/static/b04ce1d753cb93fdde96093d2165d671/6b1e2/2021-05-02-09-54-10.png 281w,/foader/static/b04ce1d753cb93fdde96093d2165d671/410f3/2021-05-02-09-54-10.png 561w,/foader/static/b04ce1d753cb93fdde96093d2165d671/d54e4/2021-05-02-09-54-10.png 747w" sizes="(max-width: 561px) 100vw, 561px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><h2 id="experiences">Experiences</h2><ul><li>Common datasets give casual users an entry point without exposing them to the underlying trace structure.</li><li>It is an open question whether a DSL can express all possible analyses, or if a general purpose language is required</li><li>Canopy is suitable for tracing any action with a well-defined begin and end. Not suitable for long running dataflow pipelines and scenarios with multiple beginning points.</li><li>Out most effective and scalable instrumentation strategies include instrumenting core frameworks, and capturing data from existing profilers and loggers.</li><li>It is an open question whether context propagation can generalize, ie, to propagate arbitrary metadata without requiring instrumentation changes.</li></ul><div class="references-block"><h3>Referred in</h3><div><div><a class="reference" href="/foader/misc/misc"><div><h5>Miscellaneous</h5></div></a></div></div></div></div><a aria-current="page" class="obstructed-label" href="/foader/misc/canopy-paper">Canopy: An End-to-End Performance Tracing and Analysis System</a></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/misc/canopy-paper";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-b26ca15045427b9506aa.js"],"app":["/app-6d93d4b14443c5d06dab.js"],"component---node-modules-gatsby-theme-garden-src-templates-local-file-js":["/component---node-modules-gatsby-theme-garden-src-templates-local-file-js-776a0c8f4079765c6542.js"]};/*]]>*/</script><script src="/foader/polyfill-b26ca15045427b9506aa.js" nomodule=""></script><script src="/foader/webpack-runtime-185bcb39f1618332114c.js" async=""></script><script src="/foader/framework-06f646d936b841f99ebd.js" async=""></script><script src="/foader/app-6d93d4b14443c5d06dab.js" async=""></script><script src="/foader/styles-407fe62976dc5310c43e.js" async=""></script><script src="/foader/component---node-modules-gatsby-theme-garden-src-templates-local-file-js-776a0c8f4079765c6542.js" async=""></script></body></html>